package com.niit.chatzonerestservice.controller;

import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.niit.chatzonebe.dao.UserDAO;
import com.niit.chatzonebe.model.User;
@RestController 
public class UserRestController {
	@Autowired 
	private User user;
	@Autowired 
     private UserDAO userDAO;
	
     
	
	private static final Logger log = LoggerFactory.getLogger(UserRestController.class);
	@GetMapping("/users")
        public ResponseEntity <List<User>> list()
    	 {
    		 List<User> userList=userDAO.list();
    		 return new ResponseEntity<List<User>>(userList,HttpStatus.OK);
    		 
    	 }
     @PostMapping("/addUser")
           public User addUser(@RequestBody User newUser) 
           {
    	      log.debug("Calling createUser");
    	      System.out.println("Calling createUser");
    	      user=userDAO.get(newUser.getId());
    	      if(user==null)
    	      {
    	    	  log.debug("User does not exists");
    	    	  System.out.println("Calling createUser not");
    	    	  userDAO.save(newUser);
    	    	  //user.setErrorcode("200");
    	    	  //user.setErrormessage("Thank you for Registration");
    	    	  
    	      }
    	      else
    	      {
    	    	  log.debug("choose another id as it is existed");
    	    	  user.setErrorcode("800");
    	    	  user.setErrormessage("choose another id");
    	      }
    	      log.debug("Ending of create user method");
    	      return newUser;
           }
    	      		
    	      
    	      
    	 
    	 
    	 
           

      
     
     
     @GetMapping("/validate/{id}/{password}")
     public User validateCredentials(@PathVariable("id") String id,@PathVariable("password") String pwd)
     {
    	 if(userDAO.isValidCredentials(id,pwd))
    	 {
    		 user.setErrorcode("200");
    		 user.setErrormessage("User Found");
    	 }
    		 else
    		 {
    			 user.setErrorcode("404");
        		 user.setErrormessage("Invalid Credentials");
    			 
    		 }
    	 return user;
     }
     /*@PostMapping("/user")
     public User createUser(@RequestBody User user) {
     user=userDAO.get(user.getId());
     if(user==null)
     {
    	 userDAO.save(user);
     }
    	 else {
    		 user.setErrorcode("800");
    		 user.setErrormessage("This id exists,please choose another id");
    		 
    		}
     
     return user;
     }*/
     
     


}
